
<div id="loader"></div>

<div style="display:none;" id="myDiv" class="animate-bottom">

<div class="container">
 
      <br />
      <h2>User Stories</h2>


  <%= render 'user_stories/breadcrumb' %>
  <br />
  <br />


<% if @user_stories.empty? %> 
  <div class="box_center">
      <%= image_tag("backlog_big.png") %>
      <br />
      <br />
      <p class="access_deny">Nenhuma user story criada. Clique em "Novo" para iniciar o backlog.</p>
      <%= link_to "Novo", new_user_story_path, class: 'green_button' %>
    </div>
  </div>
<% else %>

<%= link_to "Nova User Story", new_user_story_path, class: 'green_button' %>
<br />
<br />


<% @user_stories.each do |user_story| %>
<button class="accordion">
     
        <div class="silver_button">
          US-<%= user_story.project.initial %>-<%= user_story.id %> 
        </div> 
           <b class="accordion_title"> 
                <%= user_story.title %>
           </b>
    
       <div class="info_accordion">
      
     
      <% if user_story.priority_id == 1 %>
          <div class="mini_red_button">
               <b>Prioridade: </b>
                Alta
          </div>
       <% end %>

      <% if user_story.priority_id == 2 %>
         <div class="mini_orange_button">
             <b>Prioridade: </b>
               Média
         </div>
      <% end %>

      <% if user_story.priority_id == 3 %>
        <div class="mini_green_button">
            <b>Prioridade: </b>
            Baixa
        </div>
      <% end %>

       <div class="mini_status_button"><b>Status: </b>
         <% if user_story.status == 1 %>
          Pendente
         <% end %>
         <% if user_story.status == 2 %>
          Desenvolvimento
         <% end %>
         <% if user_story.status == 3 %>
          Code Review
         <% end %>
         <% if user_story.status == 4 %>
          QA
         <% end %>
         <% if user_story.status == 5 %>
          Concluída
         <% end %>
       </div>


       <% if user_story.sprint.nil? %>
      
      <% else %>
     
     <div class="mini_status_button">
               <b>Sprint: </b>
                <%= user_story.sprint.name %>
          </div>
    
      
     <% end %>
      </div>
</button>
      <div class="panel">
             <br />
             <%= user_story.description unless user_story.description.nil?  %>
            
            <p></p>
            <b>Lista de Sub-task associadas</b>
          
            <%= link_to '+ Adicionar', new_task_path(@task),  target: "_blank", class: 'blue_button' %>
            <br />  

              <% user_story.tasks.each do |s| %>
             
              <p class="task_content_accordion">           
                  <div class="kind_task_accordion">
                         <% if s.kind_id == 1 %>
                           <%= image_tag('bug.png', title: "Task do tipo BUG") %>
                         <% else %>
                           <%= image_tag('clipboard-task.png', title: "Task do tipo Sub-task") %>
                         <% end %>
                 </div>
       
                 <%= link_to edit_task_path(s.id) do %>
                     <div class="green_button">
                          TK-<%= user_story.project.initial %>-<%= s.id %> <%= s.title %>
                     </div>
                 <% end %>
                  
                  <% if s.priority_id == 1 %>
                    <div class="red_button">
                      <b>Prioridade: </b>
                       Alta
                    </div>
                 <% end %>

                 <% if s.priority_id == 2 %>
                    <div class="orange_button ">
                        <b>Prioridade: </b>
                          Média
                    </div>
                 <% end %>

                  <% if s.priority_id == 3 %>
                    <div class="green_button ">
                        <b>Prioridade: </b>
                        Baixa
                    </div>
                 <% end %>

                 <div class="silver_button">
                 <b>Status: </b>
                     <% if s.status == 1 %>
                      Pendente
                     <% end %>
                     <% if s.status == 2 %>
                      Desenvolvimento
                     <% end %>
                     <% if s.status == 3 %>
                      Code Review
                     <% end %>
                     <% if s.status == 4 %>
                      QA
                     <% end %>
                     <% if s.status == 5 %>
                      Concluída
                     <% end %>
                </div>
            
                 <%= link_to s, method: :delete, class: "delete_task_accordion", data: { confirm: "Deseja deletar a tarefa TK-#{user_story.project.initial}-#{ s.id } #{s.title} ?" }, title: "Remover tarefa TK-#{user_story.project.initial}-#{ s.id } #{s.title}" do %>
                   <%= image_tag('delete_btn.png') %>
                 <% end %>
            </p> 
            <% end %>
            
          <br />
          <br /> 
              <%= link_to edit_user_story_path(user_story), class: 'yellow_button' do %>
                Editar
              <% end %>
           
              <%= link_to user_story, method: :delete, data: { confirm: "Deseja deletar a história US-#{user_story.project.initial}-#{ user_story.id } #{ user_story.title } ?" }, class: 'red_button' do %>
                Remover
              <% end %>
              
            <br />
            <br />    
          
   </div> 
     
<% end %>


  <% end %> 


  <br />
  <%= paginate @user_stories %>
  <br />
  <br />
  <br />
 </div>
</div>
</div>

<script type="text/javascript">
  $(document).ready(function() {
    //$('.sortable').tablesort();
  });
  ///Accordion

  var acc = document.getElementsByClassName("accordion");
  var i;

  for (i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var panel = this.nextElementSibling;
      if (panel.style.display === "block") {
        panel.style.display = "none";
      } else {
        panel.style.display = "block";
      }
    });
  }

</script>





























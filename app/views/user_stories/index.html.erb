

<div class="container">
 <div class="info_accordion">
        <!--
        <%#= form_tag(user_stories_path, method: :get, class: "ui form") do %>
           <div class="inline field">
              <%#= text_field_tag :search, params[:search], placeholder: "Buscar User stories" %>
              <%#= image_submit_tag("search.png") %>
           </div>    
        <%# end %>
        -->
      </div>
      <br />
      <h2>User Stories</h2>


  <%= render 'user_stories/breadcrumb' %>
  <br />
  <br />

<% if @user_stories.empty? %> 
  <div class="box_center">
      <%= image_tag("backlog_big.png") %>
      <br />
      <br />
      <p class="access_deny">Nenhuma user story criada. Clique em "Novo" para iniciar o backlog.</p>
      <%= link_to "Novo", new_user_story_path, class: 'item green_button' %>
    </div>
  </div>
<% else %>

<%= link_to "Novo", new_user_story_path, class: 'item green_button' %>
<br />
<br />

<% @user_stories.each do |user_story| %>
<button class="us_accordion">
      <%= link_to user_story do %>
      <div class="green_button">
        US-<%= user_story.project.initial %>-<%= user_story.id %> 
      </div> 
         <%= user_story.title %>
      <% end %>
      
      <% if user_story.sprint.nil? %>
      
      <% else %>
      <div class="info_accordion">
     
         <%= link_to "Sprint: #{user_story.sprint.name}", scrumboard_path(user_story.project.id), class: 'ui compact teal mini button', title: 'Acessar board da sprint' %> 
      </div>
     <% end %>

      <div class="info_accordion">
      <% if user_story.priority_id == 1 %>
          <div class="mini_red_button">
               <b>Prioridade: </b>
                Alta
          </div>
       <% end %>

      <% if user_story.priority_id == 2 %>
         <div class="mini_orange_button">
             <b>Prioridade: </b>
               Média
         </div>
      <% end %>

      <% if user_story.priority_id == 3 %>
        <div class="mini_green_button ">
            <b>Prioridade: </b>
            Baixa
        </div>
      <% end %>

       <div class="mini_status_button"><b>Status: </b>
         <% if user_story.status == 1 %>
          Pendente
         <% end %>
         <% if user_story.status == 2 %>
          Desenvolvimento
         <% end %>
         <% if user_story.status == 3 %>
          Code Review
         <% end %>
         <% if user_story.status == 4 %>
          QA
         <% end %>
         <% if user_story.status == 5 %>
          Concluída
         <% end %>
       </div>
      </div>
</button>
      <div class="panel">
             <br />
             <%= user_story.description unless user_story.description.nil?  %>
            
            <p></p>
            <b>Lista de Sub-task associadas</b>
          
            <a class="blue_button" userstory="<%= user_story.id %>" title="Adicionar tarefa">+ Adicionar</a>
            <br />  
            <p>
              <% user_story.tasks.each do |s| %>
             

              <div class="kind_task_accordion">
                     <% if s.kind_id == 1 %>
                       <%= image_tag('bug.png', title: "Task do tipo BUG") %>
                     <% else %>
                       <%= image_tag('clipboard-task.png', title: "Task do tipo Sub-task") %>
                     <% end %>
             </div>
                

                 <%= link_to edit_task_path(s.id) do %>
                     <div class="ui button">TK-<%= user_story.project.initial %>-<%= s.id %> <%= s.title %></div>
                 <% end %>

                  <% if s.priority_id == 1 %>
                 
                    <div class="ui compact mini icon red basic button">
                    <b>Prioridade: </b>
                     Alta
                 </div>
                 <% end %>

                 <% if s.priority_id == 2 %>
                    <div class="ui compact mini silver icon orange basic button ">
                        <b>Prioridade: </b>
                          Média
                    </div>
                 <% end %>

                  <% if s.priority_id == 3 %>
                    <div class="ui compact mini icon green basic button ">
                        <b>Prioridade: </b>
                        Baixa
                    </div>
                 <% end %>

                 <div class="ui compact mini icon silver basic button"><b>Status: </b>
                     <% if s.status == 1 %>
                      Pendente
                     <% end %>
                     <% if s.status == 2 %>
                      Desenvolvimento
                     <% end %>
                     <% if s.status == 3 %>
                      Code Review
                     <% end %>
                     <% if s.status == 4 %>
                      QA
                     <% end %>
                     <% if s.status == 5 %>
                      Concluída
                     <% end %>
                </div>
                 
                 <%= link_to s, method: :delete, class: "delete_task_accordion", data: { confirm: "Deseja deletar a tarefa TK-#{user_story.project.initial}-#{ s.id } #{s.title} ?" }, title: "Remover tarefa TK-#{user_story.project.initial}-#{ s.id } #{s.title}" do %>
                   <%= image_tag('delete_btn.png') %>
                 <% end %>
              </p>
          
            <% end %>
          
          <br />
          <br /> 
              <%= link_to edit_user_story_path(user_story), class: 'yellow_button' do %>
                Editar
              <% end %>
           
              <%= link_to user_story, method: :delete, data: { confirm: "Deseja deletar a história US-#{user_story.project.initial}-#{ user_story.id } #{ user_story.title } ?" }, class: 'red_button' do %>
                Remover
              <% end %>
              
            <br />
            <br />    
      </div>          
<% end %>


<!-- MODAL TAREFA -->
<div class="container">
  <div class="ui small modal task">
    
    <div class="header">
      Adicionar tarefa
    </div>
    
    <div class="content">
      <div class="ui grid">
        <div class="row">
          <div class="sixteen wide tablet eight wide computer column">
            <%= form_for(@task, html: {class: 'ui form'}) do |f| %>
              <div class="field">
                <label><strong>Título: </strong></label>
                <%= f.text_field :title %>
              </div>

              <div class="field">
                <label><strong>Descrição: </strong></label>
                <%= f.rich_text_area :description  %>
              </div>
              
              <div class="field">
                <label><strong>Tipo da task </strong></label>
                <%= f.select :kind_id, Kind.all.collect {|x| [x.name, x.id]}, { prompt: 'Selecionar o tipo de tarefa' }, class: "ui search dropdown" %>
              </div>
              

              <div class="field">
                <label><strong>Prioridade</strong></label>
                <%= f.select :priority_id, Priority.all.collect {|x| [x.name, x.id]}, { prompt: 'Selecionar a prioridade de tarefa' }, class: "ui search dropdown" %>
              </div>
              
              <div class="field">
                <%= f.hidden_field :user_story_id %>
                <%= f.hidden_field :status, value: '1' %>
              </div>

              <div class="field">
                <%= f.submit 'Adicionar', class: 'ui teal button' %>
              </div>
            <% end %>
          </div>
        </div>
      </div> 
    </div>
  </div>
  <% end %> 

  <br />
  <%= paginate @user_stories %>
  <br />
  <br />
  <br />

</div>

<!-- /MODAL TAREFA -->
<script type="text/javascript">
  $(document).ready(function() {
    //$('.sortable').tablesort();
  });

  $('.dropdown').dropdown({ allowLabels:true});

  $('.button.new_criterion').click(function(){
    $('#user_story_acceptance_criterion_user_story_id').val($(this).attr('userstory'));
    $('.ui.modal.criterion').modal('show');
    return false;
  });

  $('blue_button').click(function(){
    $('#task_user_story_id').val($(this).attr('userstory'));
    $('.modal_task').modal('show');
    return false;
  });
  
  ///Accordion

  var acc = document.getElementsByClassName("us_accordion");
  var i;

  for (i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var panel = this.nextElementSibling;
      if (panel.style.display === "block") {
        panel.style.display = "none";
      } else {
        panel.style.display = "block";
      }
    });
  }
</script>
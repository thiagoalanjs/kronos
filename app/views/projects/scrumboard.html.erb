<style type="text/css">
    .ui-widget-header {
      background: #4DD257;
			border-radius: 5px;
    }
</style>


<div class="container">  
<br />
<h1>Board <%= image_tag("scrumboard-icon.png")%></h1>
<hr>
 <br />
 <br />
<% if @project.sprints.empty? && current_user.group == 'analista' %> 
        <div class="box_center">
            <%= image_tag("access-denied.png") %>
            <br />
            <br />
            <p class="access_deny">Nenhuma sprint ativa no momento. Entre em contato com o administrador / PO.</p>
        </div>


<% elsif @project.sprints.empty? && current_user.group != 'coordenador' && current_user.group != 'coordenador'  %>
        <div class="box_center">
            <%= image_tag("access-denied.png") %>
            <br />
            <br />
            <p class="access_deny">Nenhuma sprint ativa no momento.</p>
            <%= link_to "Criar sprint", new_sprint_path, class: " green_button"%>
        </div>
<% end %>

<% else %>

<% @sprint = sprint_actived %>
<div class="info_accordion">

  <% @sprint.each_with_index do |sprint, i| %>
     <%= link_to "Nova User Story", new_user_story_path, class: "red_button" %> 
    <%= link_to "Nova task", new_task_path, class: "blue_button" %>
  <% end %>
</div>

<% @sprint.each_with_index do |sprint, i| %>
<div class=" bottom attached tab segment <%= 'active' if i == 0 %>" data-tab="tab-<%= sprint.id %>">
    
 <a class="item <%= 'active' if i == 0 %>" data-tab="tab-<%= sprint.id %>"><b>Sprint:</b> <%= sprint.name %></a>

<br />

<br />
<br />
   <div id="progressbar" class="ui-progressbar-value ui-widget-header ui-corner-left" style="border: 1px solid black; color: black; height:30px; padding-top: 10px; text-align: center; width:<%= @project.progress %>%;">
      <%= sprint.progress %>% Concluído
    </div>
  </div>
<br />
<br />
<br />
  <table class="ui celled table">
    <thead>
      <tr>
        <th width="180">Pendente</th>
        <th width="180">Desenvolvimento</th>
        <th width="180">Code Review</th>
        <th width="180">QA</th>
        <th width="180">Concluído</th>
      </tr>
    </thead>

    <tbody>
      <tr>
        <td>
       
          <% sprint.user_stories.each do |us| %>
          <!-- CARD -->
          <% us.tasks.where(status: 1).each do |task| %>
              <div class="content_task">           
                 <%= link_to task_path(task.id) do %>
                  <h3>
                 
                     <% if task.kind_id == 1 %>
                       <%= image_tag('bug.png', title: "Task do tipo BUG") %>
                     <% else %>
                       <%= image_tag('clipboard-task.png', title: "Task do tipo Sub-task") %>
                     <% end %>
                 
                     TK-<%= @project.initial %>-<%= task.id %>  <%= task.title %>
                  </h3>
                <% end %>
          
              
                <div class="description">
                  <p>
                        <a href="#" data-modal="usertory-<%= us.id %>" class="  mini button modal-task">
                          Detalhes
                        </a>

                        <%= link_to take_task_path(task.id), class: '  mini teal button' do %>
                          Atribuir
                        <% end %>
                  </p>

                  <p>
                  Criada em: <%= l task.created_at%>
                 <% if task.priority_id == 1 %>
                    <div class="mini_red_button">
                    <b>Prioridade: </b>
                    </div>
                 <% end %>

                 <% if task.priority_id == 2 %>
                    <div class="mini_silver_button">
                        <b>Prioridade: </b>
                          Média
                    </div>
                 <% end %>

                  <% if task.priority_id == 3 %>
                    <div class="mini_green_button">
                        <b>Prioridade: </b>
                        Baixa
                    </div>
                 <% end %>
                  </p>
                    
               
              <div class="extra_content">
                <div class="right floated author">
                <% task.users.each do |u| %>
                    <% if u.avatar.attached? %>
                        <%= image_tag(u.avatar_thumbnail, :class=> "image_profile_card") %>
                       <% else %>
                        <%= image_tag("profile-no-image.png", :class=> "image_profile_card") %>
                    <% end %>
                <% end %>
              </div>
            </div>
          </div>
          <% end %>
          <!-- /CARD -->
          <% end %>
         
                </div>
              </div>
        </td>
</div>
        <td>
          <% sprint.user_stories.each do |us| %>       
          <% us.tasks.where(status: 2).each do |task| %>
            <p></p>
            <!-- CARD -->
            <div>
              <div class="content_task">
                <div class="meta">
                <%= link_to task_path(task.id) do %>
                  <h3>
                 
                     <% if task.kind_id == 1 %>
                       <%= image_tag('bug.png', title: "Task do tipo BUG") %>
                     <% else %>
                       <%= image_tag('clipboard-task.png', title: "Task do tipo Sub-task") %>
                     <% end %>
                 
                     <span class="category">TK-<%= @project.initial %>-<%= task.id %>  <%= task.title %></span>
                  </h3>
                <% end %>
                </div>
                 <div class="description">
                  <div class=" mini icon buttons">
                  
                    <a href="#" data-modal="usertory-<%= us.id %>" class=" mini icon button modal-task" title="Detalhes">
                    <%= image_tag("info.png") %>
                    </a>
                 
                    <%= link_to get_out_task_path(task.id), class: ' mini yellow button', title: 'Voltar para a coluna pendente' do %>
                      Sair
                    <% end %>

                    <%= link_to take_task_path(task.id), class: ' mini orange button', title: 'Participar da tarefa' do %>
                      Ajudar
                    <% end %>

                    <%= link_to send_to_code_review_path(task.id), class: ' mini teal button', title: 'Enviar para Code Review' do %>
                      Code Review
                    <% end %>
                 
                  </div>

                
                  <p>
                  <br />
                      Criada em: <%= l task.created_at%>
                      <% if task.priority_id == 1 %>
                         <div class=" compact mini icon red basic button">
                         <b>Prioridade: </b>
                          Alta
                         </div>
                      <% end %>

                      <% if task.priority_id == 2 %>
                         <div class="mini_silver_button">
                             <b>Prioridade: </b>
                               Média
                         </div>
                      <% end %>

                      <% if task.priority_id == 3 %>
                        <div class="mini_green_button">
                            <b>Prioridade: </b>
                            Baixa
                        </div>
                      <% end %>
                  </p>   
             </div>
              
              <div class="extra_content">
                <div class="right floated author">
       <% task.users.each do |u| %>

        <% if u.avatar.attached? %>
            <%= image_tag(u.avatar_thumbnail, :class=> "image_profile_card") %>
           <% else %>
            <%= image_tag("profile-no-image.png", :class=> "image_profile_card") %>
        <% end %>

          <% end %>
                </div>
              </div>
            </div>
          <% end %>
          <!-- /CARD -->
          <% end %>
        </td>

        <td class="top aligned">
          <% sprint.user_stories.each do |us| %>
          <% us.tasks.where(status: 3).each do |task| %>
            <p></p>
            <!-- CARD -->
            <div>
              <div class="content_task">
                <div class="meta">
                    <%= link_to task_path(task.id) do %>
                  <h3>
                 
                     <% if task.kind_id == 1 %>
                       <%= image_tag('bug.png', title: "Task do tipo BUG") %>
                     <% else %>
                       <%= image_tag('clipboard-task.png', title: "Task do tipo Sub-task") %>
                     <% end %>
                 
                     <span class="category">TK-<%= @project.initial %>-<%= task.id %>  <%= task.title %></span>
                  </h3>
                <% end %>  
                 </div>

                <div class="description">
                  <div class=" mini icon buttons">
                        <a href="#" data-modal="usertory-<%= us.id %>" class=" mini icon button modal-task" title="Detalhes">
                          <%= image_tag("info.png") %></a>
                        <%= link_to get_out_task_path(task.id), class: 'mini_orange_button' do %>
                          Pendente
                        <% end %>
                        <%= link_to take_task_path(task.id), class: 'mini_red_button' do %>
                          Desenvolvimento
                        <% end %>
                        <%= link_to send_task_to_test_path(task.id), class: ' mini green button' do %>
                          QA
                        <% end %>
                  </div>
  
                  <p>
                  <br />
                     Criada em: <%= l task.created_at%>
                    <% if task.priority_id == 1 %>
                       <div class="mini_red_button">
                       <b>Prioridade: </b>
                        Alta
                       </div>
                    <% end %>

                    <% if task.priority_id == 2 %>
                       <div class="mini_orange_button">
                           <b>Prioridade: </b>
                             Média
                       </div>
                    <% end %>

                     <% if task.priority_id == 3 %>
                       <div class="mini_green_button">
                           <b>Prioridade: </b>
                           Baixa
                       </div>
                    <% end %>
                 </p>
               </div>
 
              <div class="extra_content">
                <div class="right floated author">
                  <% task.users.each do |u| %>
                    <% if u.avatar.attached? %>
                          <%= image_tag(u.avatar_thumbnail, :class=> "image_profile_card") %>
                    <% else %>
                        <%= image_tag("profile-no-image.png", :class=> "image_profile") %>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
          <!-- /CARD -->
          <% end %>
        </td>


         <td class="top aligned">
          <% sprint.user_stories.each do |us| %>
      

          <% us.tasks.where(status: 4).each do |task| %>
            <p></p>
            <!-- CARD -->
            <div class=" blue card">
              <div class="content_task">
                <div class="meta">
                    <%= link_to task_path(task.id) do %>
                  <h3>
                 
                     <% if task.kind_id == 1 %>
                       <%= image_tag('bug.png', title: "Task do tipo BUG") %>
                     <% else %>
                       <%= image_tag('clipboard-task.png', title: "Task do tipo Sub-task") %>
                     <% end %>
                 
                     <span class="category">TK-<%= @project.initial %>-<%= task.id %>  <%= task.title %></span>
                  </h3>
                <% end %> 
                </div>
                <div class="description">
          
                  <div class=" mini icon buttons">
                    <a href="#" data-modal="usertory-<%= us.id %>" class=" mini icon button modal-task" title="Detalhes">
                      <%= image_tag("info.png") %>
                    </a>

                    <%= link_to get_out_task_path(task.id), class: ' mini orange button' do %>
                      Sair
                    <% end %>
                    
                    <%= link_to take_task_path(task.id), class: ' mini red button' do %>
                          Desenvolvimento
                        <% end %>

                    <%= link_to send_to_code_review_path(task.id), class: ' mini teal button' do %>
                      Code Review
                    <% end %>

                    <%= link_to take_task_path(task.id), class: ' mini teal button', title: 'Participar da tarefa' do %>
                      Ajudar
                    <% end %>

                    <%= link_to done_task_path(task.id), class: ' mini green button' do %>
                      Pronto
                    <% end %>
                  </div>

                </div>
              </div>
              <div class="extra_content">
                <div class="right floated author">
                  <% task.users.each do |u| %>
                   <% if u.avatar.attached? %>
                          <%= image_tag(u.avatar_thumbnail, :class=> "image_profile_card") %>
                    <% else %>
                        <%= image_tag("profile-no-image.png", :class=> "image_profile_card") %>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
          <!-- /CARD -->
          <% end %>
        </td>

        <td class="top aligned">
          <% sprint.user_stories.each do |us| %>
          
          <% us.tasks.where(status: 5).each do |task| %>
            <p></p>
            <!-- CARD -->
            <div>
              <div class="content_task">
                
                <div class="meta">
                    <%= link_to task_path(task.id) do %>
                  <h3>
                 
                     <% if task.kind_id == 1 %>
                       <%= image_tag('bug.png', title: "Task do tipo BUG") %>
                     <% else %>
                       <%= image_tag('clipboard-task.png', title: "Task do tipo Sub-task") %>
                     <% end %>
                 
                     <span class="category">TK-<%= @project.initial %>-<%= task.id %>  <%= task.title %></span>
                  </h3>
                <% end %> 
                </div>
                <div class="description">
                  <div class=" mini icon buttons">
                    <a href="#" data-modal="usertory-<%= us.id %>" class="  mini icon button modal-task" title="Detalhes">
                      <%= image_tag("info.png") %>
                    </a>
                    <%= link_to redo_task_path(task.id), class: '  mini teal button', title: 'Enviar para teste' do %>
                      Refazer
                    <% end %>
                  </div>
                  <p></p>
                  <% unless task.start_date.nil? %>
                  <p>
                    <strong>Inicio em:</strong>
                    <%= l task.start_date %>
                  </p>
                  <% end %>
                  
                  <% unless task.end_date.nil? %>
                  <p>
                    <strong>Concluído em:</strong>
                    <%= l task.end_date %>
                  </p>
                  <% end %>
                </div>
              </div>
              <div class="extra_content">
                <div class="right floated author">
                  <% task.users.each do |u| %>
                    <% if u.avatar.attached? %>
                          <%= image_tag(u.avatar_thumbnail, :class=> "image_profile_card") %>
                    <% else %>
                        <%= image_tag("profile-no-image.png", :class=> "image_profile_card") %>
                    <% end %>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
          <!-- /CARD -->
          <% end %>
        </td>
      </tr>
    </tbody>
  </table>
</div>
</div>
<% end %>


<script type="text/javascript">
  $('.modal-task').click(function(){
    $('.'+$(this).attr('data-modal')).modal('show');
    return false;
  });
</script>